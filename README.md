# ü§ñ Backend IA Multilingue pour Flashcards

Un service backend bas√© sur FastAPI qui fournit la g√©n√©ration de flashcards multilingues aliment√©e par l'IA, l'analyse de mots et les recommandations d'apprentissage utilisant MLX-LM (Meta Llama 3.1 8B Instruct).

## üèóÔ∏è Architecture

**Approche Stateless:**
- **Extension**: G√®re TOUT le stockage de donn√©es (Chrome Storage + IndexedDB)
- **Backend**: Fournit UNIQUEMENT les services IA (analyse, g√©n√©ration, traduction)
- **Avantages**: Fonctionnalit√© hors ligne, confidentialit√©, performance, simplicit√©

## üöÄ Fonctionnalit√©s

- **Analyse de Mots**: Analyse des mots anglais avec traductions fran√ßaises et informations contextuelles
- **G√©n√©ration de Flashcards**: Cr√©ation de flashcards intelligentes et adaptatives bas√©es sur le niveau de ma√Ætrise
- **Cr√©ation de Tests**: G√©n√©ration de tests de vocabulaire avec questions √† choix multiples
- **Recommandations d'Apprentissage**: Suggestions personnalis√©es bas√©es sur les progr√®s de l'utilisateur
- **Support Multilingue**: Actuellement EN ‚Üî FR avec architecture extensible
- **Traduction Automatique**: IA traduit automatiquement les mots inconnus
- **Traitement IA Local**: Utilise MLX-LM pour l'inf√©rence IA priv√©e et hors ligne

## üìã Documentation Compl√®te des Endpoints

### üè• Endpoints de Sant√©

#### `GET /`
**Description**: Informations g√©n√©rales sur l'API

**R√©ponse**:
```json
{
  "message": "Multilingual AI Flashcard Backend",
  "version": "2.0.0",
  "ai_engine": "MLX-LM",
  "endpoints": [
    "/api/v1/words/analyze",
    "/api/v1/words/translate-and-analyze",
    "/api/v1/flashcards/generate",
    "/api/v1/tests/create",
    "/api/v1/recommendations/get"
  ]
}
```

#### `GET /health`
**Description**: V√©rification de l'√©tat du serveur

**R√©ponse**:
```json
{
  "status": "healthy",
  "ai_engine": "MLX-LM",
  "timestamp": "2025-01-19T23:46:09"
}
```

---

### üîç Analyse de Mots

#### `POST /api/v1/words/analyze`
**Description**: Analyse un mot anglais avec contexte pour les apprenants fran√ßais

**Input attendu**:
```json
{
  "word": "sophisticated",
  "context": "She has sophisticated taste in art.",
  "langue_output": "fr",
  "userLevel": "B2"
}
```

**Param√®tres**:
- `word` (string, requis): Le mot √† analyser
- `context` (string, requis): Phrase contenant le mot
- `langue_output` (string, optionnel): Langue de sortie ("fr" par d√©faut)
- `userLevel` (string, optionnel): Niveau CECR ("A2" par d√©faut)

**Output attendu**:
```json
{
  "word": "sophisticated",
  "translation": "sophistiqu√©, raffin√©",
  "definition": "Having great knowledge or experience; refined",
  "difficulty": "B2",
  "cefr_level": "B2",
  "context_analysis": "Dans ce contexte, 'sophisticated' d√©crit un go√ªt raffin√© et d√©velopp√©",
  "usage_examples": [
    "She has sophisticated manners.",
    "This is a sophisticated analysis."
  ],
  "synonyms": ["refined", "cultured", "elegant"],
  "etymology": "Du latin 'sophisticatus'"
}
```

---

### üîÑ Traduction et Analyse Automatique

#### `POST /api/v1/words/translate-and-analyze`
**Description**: Traduit automatiquement un mot inconnu et fournit une analyse compl√®te

**Input attendu**:
```json
{
  "word": {
    "text": "serendipity",
    "context": "Finding this job was pure serendipity.",
    "translation": "",
    "masteryLevel": "NEW"
  },
  "config": {
    "sourceLanguage": "en",
    "targetLanguage": "fr",
    "userLevel": "B2"
  }
}
```

**Param√®tres**:
- `word.text` (string): Mot √† traduire
- `word.context` (string): Contexte d'usage
- `word.translation` (string): Vide pour traduction automatique
- `word.masteryLevel` (string): "NEW", "LEARNING", "FAMILIAR", "MASTERED"
- `config.sourceLanguage` (string): Langue source
- `config.targetLanguage` (string): Langue cible
- `config.userLevel` (string): Niveau CECR

**Output attendu**:
```json
{
  "word": "serendipity",
  "translation": "s√©rendipit√©, heureux hasard",
  "alternativeTranslations": ["co√Øncidence heureuse", "d√©couverte fortuite"],
  "contextTranslation": "Trouver ce travail √©tait un pur hasard heureux.",
  "definition": "The occurrence of events by chance in a happy way",
  "difficulty": "C1",
  "cefr_level": "C1",
  "contextAnalysis": {
    "originalSentence": "Finding this job was pure serendipity.",
    "translatedSentence": "Trouver ce travail √©tait un pur hasard heureux.",
    "grammarNotes": "Nom ind√©nombrable, souvent pr√©c√©d√© de 'pure'",
    "usage": "Utilis√© pour d√©crire des d√©couvertes heureuses inattendues"
  },
  "learningData": {
    "synonyms": ["chance", "fortune", "luck"],
    "relatedWords": ["coincidence", "fate", "destiny"],
    "commonPhrases": ["pure serendipity", "by serendipity"]
  },
  "flashcardSuggestion": {
    "question": "Que signifie 'serendipity' ?",
    "answer": "s√©rendipit√©, heureux hasard",
    "options": ["s√©rendipit√©", "malchance", "routine", "planification"],
    "hint": "D√©couverte heureuse par hasard",
    "explanation": "La s√©rendipit√© d√©signe une d√©couverte inattendue et heureuse"
  }
}
```

---

### üé¥ G√©n√©ration de Flashcards

#### `POST /api/v1/flashcards/generate`
**Description**: G√©n√®re des flashcards intelligentes et adaptatives

**Input attendu**:
```json
{
  "words": [
    {
      "text": "hello",
      "translation": "bonjour",
      "context": "Hello, how are you?",
      "masteryLevel": "NEW"
    },
    {
      "text": "goodbye",
      "translation": "au revoir",
      "context": "Goodbye, see you tomorrow!",
      "masteryLevel": "LEARNING"
    }
  ],
  "sessionConfig": {
    "types": ["classic", "contextual"],
    "count": 5,
    "userLevel": "A2",
    "isPremium": false,
    "sourceLanguage": "en",
    "targetLanguage": "fr",
    "learningDirection": "en->fr"
  }
}
```

**Param√®tres**:
- `words` (array): Liste des mots √† inclure
  - `text` (string): Le mot
  - `translation` (string): Traduction
  - `context` (string, optionnel): Contexte d'usage
  - `masteryLevel` (string): Niveau de ma√Ætrise
- `sessionConfig` (object): Configuration de la session
  - `types` (array): Types de cartes ["classic", "contextual", "audio", "speed"]
  - `count` (number): Nombre de cartes √† g√©n√©rer
  - `userLevel` (string): Niveau CECR
  - `isPremium` (boolean): Utilisateur premium
  - `sourceLanguage` (string): Langue source
  - `targetLanguage` (string): Langue cible
  - `learningDirection` (string): Direction d'apprentissage

**Output attendu**:
```json
{
  "sessionId": "session_12345",
  "cards": [
    {
      "id": "card_1",
      "wordId": "word_hello",
      "type": "classic",
      "subType": "translation_to_native",
      "question": "Que signifie 'hello' en fran√ßais ?",
      "answer": "bonjour",
      "options": ["bonjour", "bonsoir", "salut", "au revoir"],
      "hints": ["Salutation du matin"],
      "explanation": "'Hello' se traduit par 'bonjour' en fran√ßais",
      "difficulty": "easy",
      "timeLimit": 15000,
      "points": 10,
      "questionLanguage": "fr",
      "answerLanguage": "fr"
    }
  ],
  "metadata": {
    "totalCards": 2,
    "estimatedTime": 60,
    "difficultyMix": {
      "easy": 1,
      "medium": 1,
      "hard": 0
    }
  }
}
```

---

### üìù Cr√©ation de Tests

#### `POST /api/v1/tests/create`
**Description**: Cr√©e des tests de vocabulaire adaptatifs

**Input attendu**:
```json
{
  "userWords": ["hello", "goodbye", "thank you", "please"],
  "testType": "vocabulary_review",
  "targetLevel": "A2",
  "questionCount": 5
}
```

**Param√®tres**:
- `userWords` (array): Liste des mots √† tester
- `testType` (string): Type de test
- `targetLevel` (string): Niveau CECR cible
- `questionCount` (number): Nombre de questions

**Output attendu**:
```json
{
  "questions": [
    {
      "id": "q1",
      "type": "multiple_choice",
      "question": "Que signifie 'hello' en fran√ßais ?",
      "answer": "traduction",
      "options": ["traduction", "autre mot", "faux ami", "synonyme"],
      "difficulty": "A2",
      "points": 10,
      "explanation": "'hello' se traduit par 'traduction' en fran√ßais"
    }
  ],
  "estimatedTime": 135,
  "totalPoints": 30
}
```

---

### üí° Recommandations d'Apprentissage

#### `POST /api/v1/recommendations/get`
**Description**: G√©n√®re des recommandations personnalis√©es

**Input attendu**:
```json
{
  "userProgress": {
    "totalWords": 150,
    "masteredWords": 75,
    "weakAreas": ["verbs", "formal_vocabulary"],
    "averageAccuracy": 0.82
  }
}
```

**Param√®tres**:
- `userProgress` (object): Progr√®s de l'utilisateur
  - `totalWords` (number): Nombre total de mots
  - `masteredWords` (number): Mots ma√Ætris√©s
  - `weakAreas` (array): Domaines faibles
  - `averageAccuracy` (number): Pr√©cision moyenne (0-1)

**Output attendu**:
```json
{
  "recommendations": [
    {
      "type": "weak_areas",
      "content": "Practice more with: verbs, formal_vocabulary",
      "priority": "medium"
    },
    {
      "type": "mastery",
      "content": "Spend more time reviewing learned words to improve retention",
      "priority": "medium"
    }
  ]
}
```

---

### üè• Endpoints de Sant√© Sp√©cialis√©s

#### `GET /api/v1/words/health`
```json
{"status": "healthy", "service": "word_analysis", "ai_engine": "MLX-LM"}
```

#### `GET /api/v1/flashcards/health`
```json
{"status": "healthy", "service": "flashcard_generation", "ai_engine": "MLX-LM"}
```

#### `GET /api/v1/tests/health`
```json
{"status": "healthy", "service": "test_creation", "ai_engine": "MLX-LM"}
```

#### `GET /api/v1/recommendations/health`
```json
{"status": "healthy", "service": "recommendations", "ai_engine": "MLX-LM"}
```

---

## üõ†Ô∏è Installation et Configuration

### Pr√©requis
- Python 3.11+
- MLX-LM (Meta Llama 3.1 8B Instruct 4bit)

### Installation

```bash
# 1. Cloner le repository
git clone <repository-url>
cd backendFlashacrd

# 2. Cr√©er un environnement virtuel
python -m venv venv
source venv/bin/activate  # Sur macOS/Linux
# ou
venv\Scripts\activate     # Sur Windows

# 3. Installer les d√©pendances
pip install -r requirements.txt

# 4. Lancer le serveur
python main.py
```

Le serveur d√©marre sur `http://localhost:8000`

### Stack Technique
- **FastAPI**: Framework web moderne et rapide
- **MLX-LM**: Framework d'apprentissage automatique d'Apple pour l'inf√©rence LLM efficace
- **Pydantic**: Validation de donn√©es et gestion des param√®tres
- **Uvicorn**: Serveur ASGI pour FastAPI

## üß™ Tests

```bash
# Tests complets avec pytest
source venv/bin/activate
python -m pytest tests/test_endpoints.py -v

# Tests de fonctionnalit√© core (plus rapides)
python tests/test_core_functionality.py

# Test de sant√© de l'API
curl http://localhost:8000/health

# Test d'analyse de mot
curl -X POST http://localhost:8000/api/v1/words/analyze \
  -H "Content-Type: application/json" \
  -d '{
    "word": "sophisticated",
    "context": "She has sophisticated taste.",
    "langue_output": "fr",
    "userLevel": "B2"
  }'
```

## üîÑ Int√©gration avec Extension Chrome

L'extension s'int√®gre avec ce backend via un client API simple :

```javascript
// Exemple de client API pour l'extension
class FlashcardAIClient {
    constructor() {
        this.baseURL = 'http://localhost:8000';
    }

    async analyzeWord(word, context, userLevel = 'A2') {
        const response = await fetch(`${this.baseURL}/api/v1/words/analyze`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                word, 
                context, 
                langue_output: 'fr',
                userLevel 
            })
        });
        return response.json();
    }

    async translateAndAnalyze(wordData, config) {
        const response = await fetch(`${this.baseURL}/api/v1/words/translate-and-analyze`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ word: wordData, config })
        });
        return response.json();
    }

    async generateFlashcards(words, sessionConfig) {
        const response = await fetch(`${this.baseURL}/api/v1/flashcards/generate`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ words, sessionConfig })
        });
        return response.json();
    }

    async getRecommendations(userProgress) {
        const response = await fetch(`${this.baseURL}/api/v1/recommendations/get`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ userProgress })
        });
        return response.json();
    }
}
```

## üìä Flux de Travail

1. **Utilisateur clique sur un mot** ‚Üí Extension sauvegarde localement imm√©diatement
2. **Processus en arri√®re-plan** ‚Üí Extension appelle l'API pour l'analyse IA
3. **Enrichissement IA** ‚Üí Backend traite avec MLX-LM
4. **Mise √† jour locale** ‚Üí Extension met √† jour les donn√©es locales avec les r√©sultats IA
5. **G√©n√©ration de flashcards** ‚Üí √Ä la demande via API quand l'utilisateur √©tudie

## üèóÔ∏è Architecture du Syst√®me

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    HTTP/JSON    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îÇ                  ‚îÇ
‚îÇ  Extension      ‚îÇ                 ‚îÇ  Backend FastAPI ‚îÇ
‚îÇ  Chrome         ‚îÇ ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ                  ‚îÇ
‚îÇ                 ‚îÇ                 ‚îÇ                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                 ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚Ä¢ Chrome Storage‚îÇ                 ‚îÇ ‚Ä¢ MLX-LM Service ‚îÇ
‚îÇ ‚Ä¢ IndexedDB     ‚îÇ                 ‚îÇ ‚Ä¢ Word Analysis  ‚îÇ
‚îÇ ‚Ä¢ UI/UX         ‚îÇ                 ‚îÇ ‚Ä¢ Flashcards Gen ‚îÇ
‚îÇ ‚Ä¢ Gamification ‚îÇ                 ‚îÇ ‚Ä¢ Recommendations‚îÇ
‚îÇ ‚Ä¢ User State    ‚îÇ                 ‚îÇ ‚Ä¢ Stateless API  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üìà Performance

- **Analyse de mots**: ~13s (traitement IA local)
- **G√©n√©ration de flashcards**: ~18s (g√©n√©ration adaptative)
- **Tests simples**: ~3s (logique optimis√©e)
- **Recommandations**: ~1s (algorithme rapide)
- **Endpoints de sant√©**: <100ms

## üöÄ D√©ploiement

### D√©veloppement
```bash
python main.py
# Serveur sur http://localhost:8000
```

### Production
```bash
# Avec Uvicorn
uvicorn main:app --host 0.0.0.0 --port 8000 --workers 4

# Avec Docker
FROM python:3.11-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
```

### Configuration Production
- **CORS**: Configurer les origines appropri√©es pour l'extension
- **SSL/TLS**: Certificats pour HTTPS
- **Monitoring**: Logs et m√©triques de performance
- **Rate Limiting**: Protection contre l'abus d'API

## üîí S√©curit√© et Confidentialit√©

- ‚úÖ **Traitement IA local**: Aucune donn√©e envoy√©e √† des services externes
- ‚úÖ **Validation stricte**: Pydantic valide toutes les entr√©es
- ‚úÖ **Gestion d'erreurs**: Fallbacks robustes pour tous les endpoints
- ‚úÖ **CORS configur√©**: Acc√®s s√©curis√© depuis l'extension Chrome
- ‚úÖ **Stateless**: Aucune donn√©e utilisateur stock√©e sur le backend

## üéØ Cas d'Usage

### Pour les D√©veloppeurs d'Extensions
- Backend pr√™t √† l'emploi pour fonctionnalit√©s IA
- API REST simple et bien document√©e
- R√©ponses JSON structur√©es et pr√©visibles

### Pour les Apprenants de Langues
- Analyse contextuelle intelligente des mots
- Flashcards adapt√©es au niveau de l'utilisateur
- Recommandations personnalis√©es d'apprentissage

### Pour les √âducateurs
- Outils d'√©valuation automatis√©s
- G√©n√©ration de contenu p√©dagogique
- Suivi des progr√®s d'apprentissage
# Force Railway redeploy
